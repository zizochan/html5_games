!function e(t,n,o){function r(u,a){if(!n[u]){if(!t[u]){var f="function"==typeof require&&require;if(!a&&f)return f(u,!0);if(i)return i(u,!0);var c=new Error("Cannot find module '"+u+"'");throw c.code="MODULE_NOT_FOUND",c}var l=n[u]={exports:{}};t[u][0].call(l.exports,function(e){var n=t[u][1][e];return r(n?n:e)},l,l.exports,e,t,n,o)}return n[u].exports}for(var i="function"==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0});n.TILE_WIDTH=12,n.TILE_HEIGHT=12,n.TILE_CHAIN=3,n.TILE_MOVE_SPEED=20,n.INTERVAL_NUMBER=25,n.BGM_VOLUME=.1,n.MOVE_COUNT=50,n.TIME_LIMIT=69,n.COLOR_NUMBER=5,n.TIMER_IMAGE_NUMBER=15,n.TILE_IMAGE_SIZE=44,n.BACK_IMAGE_LEFT_MARGIN=34,n.BACK_IMAGE_TOP_MARGIN=36},{}],2:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i={TITLE:1,PLAY:2,GAMEOVER:3},u=function(){function e(){o(this,e),this.reset()}return r(e,[{key:"getStatus",value:function(){return i}},{key:"reset",value:function(){this.state=i.TITLE}},{key:"isTitle",value:function(){return this.state==i.TITLE}},{key:"changePlay",value:function(){this.state=i.PLAY}},{key:"isPlay",value:function(){return this.state==i.PLAY}},{key:"changeGameover",value:function(){this.state=i.GAMEOVER}},{key:"isGameover",value:function(){return this.state==i.GAMEOVER}}]),e}();n["default"]=u},{}],3:[function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{"default":e}}function r(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t["default"]=e,t}var i,u,a,f,c,l,s,E,I=e("./config"),v=r(I),_=e("./tile"),T=o(_),h=e("./flag"),M=o(h),g=e("./mouse_utility"),m=o(g),L=new m["default"],d=[],y=0,p=0,A=NaN,N=NaN,G=0,b=null,O=null,H=null,R=null,w=["","good","very good","super","wonderful!","great!","amazing!","brilliant!","excelllent!"],P=function(){i=new M["default"],x(),U(),l=$("#bgimage").get(0),E=$("#sound").get(0);var e=$("#canvas");u=e.get(0).getContext("2d"),u.textAlign="center",$("#START").get(0).onclick=C,k(),te()},k=function(){c=0,i.reset()},C=function(){S(),N=new Date,A=setInterval(X,v.INTERVAL_NUMBER),$("body").get(0).addEventListener("touchmove",function(e){e.preventDeafult()},!1),$("#START").hide(),B(),i.changePlay()},S=function(){var e=$("#canvas").get(0);e.onmousedown=F,e.onmouseup=q,e.addEventListener("touchstart",F),e.addEventListener("touchmove",K),e.addEventListener("touchend",q)},B=function(){s=$("#bgm").get(0),s.volume=v.BGM_VOLUME,s.loop=!0,s.play()},x=function(){a=[];for(var e=0;e<v.TILE_WIDTH;e++){a[e]=[];for(var t=0;t<v.TILE_HEIGHT;t++)a[e][t]=new T["default"](e,t,v.TILE_MOVE_SPEED)}D(function(e,t,n){for(;;){var o=Y(v.COLOR_NUMBER);if(W(e,t,o)){n.color=o;break}}})},U=function(){f=[];for(var e=0;e<=v.TIMER_IMAGE_NUMBER;e++){var t=$("<img>").attr({src:"images/time"+e+".png"});f.push(t)}},Y=function(e){return Math.floor(Math.random()*e)},D=function(e){for(var t=0;t<v.TILE_WIDTH;t++)for(var n=0;n<v.TILE_HEIGHT;n++)e(t,n,a[t][n])},X=function(){V(),G=((new Date).getTime()-N)/1e3,G>v.TIME_LIMIT&&j(),te()},V=function(){if(p=Math.max(0,p-1),0==p&&(y=0),!(d.length<=0)){for(var e=0;e<d.length;e++)d[e].update();if(d=d.filter(function(e){return 0!=e.count}),0==d.length){var t=Q();t>0&&(y=Math.min(w.length-1,y+1),p=v.MOVE_COUNT,c+=t*y,E.pause(),E.currentTime=0,E.play()),ee()}}},j=function(){clearInterval(A),A=NaN,i.changeGameover(),s.pause()},W=function(e,t,n){var o=!1;return 1<e&&(o|=Z(n,e-1,t,e-2,t)),e<v.TILE_WIDTH-4&&(o|=Z(n,e+1,t,e+2,t)),1<t&&(o|=Z(n,e,t-1,e,t-2)),t<v.TILE_HEIGHT-4&&(o|=Z(n,e,t+1,e,t+2)),!o},Z=function(e,t,n,o,r){var i=a[t][n].color,u=a[o][r].color;return i==u&&u==e},F=function(e){b=L.getXPosition(e),O=L.getYPosition(e)},K=function(e){H=L.getXPosition(e),R=L.getYPosition(e)},q=function(e){var t=Math.floor((b-v.BACK_IMAGE_LEFT_MARGIN)/v.TILE_IMAGE_SIZE),n=Math.floor((O-v.BACK_IMAGE_TOP_MARGIN)/v.TILE_IMAGE_SIZE),o=t,r=n,i=isNaN(e.offsetX)?H:e.offsetX,u=isNaN(e.offsetY)?R:e.offsetY;Math.abs(i-b)>Math.abs(u-O)?o+=i-b>0?1:-1:r+=u-O>0?1:-1,z(t,n,o,r),te()},z=function(e,t,n,o){if(!J(e,t)&&!J(n,o)){var r=a[e][t].color;a[e][t].move(n,o,a[n][o].color),a[n][o].move(e,t,r),d.push(a[e][t]),d.push(a[n][o])}},J=function(e,t){return e>=v.TILE_WIDTH||t>=v.TILE_HEIGHT||e<0||t<0||a[e][t].moving},Q=function(){for(var e=0;e<v.TILE_HEIGHT;e++)for(var t=a[0][e].color,n=1,o=1;o<v.TILE_WIDTH;o++){var r=a[o][e].color;if(t!=r)t=r,n=1;else if(++n>=v.TILE_CHAIN)for(var i=0;i<v.TILE_CHAIN;i++)a[o-i][e].remove=!0}for(var o=0;o<v.TILE_WIDTH;o++)for(var t=a[o][0].color,n=1,e=1;e<v.TILE_HEIGHT;e++){var r=a[o][e].color;if(t!=r)t=r,n=1;else if(++n>=v.TILE_CHAIN)for(var i=0;i<v.TILE_CHAIN;i++)a[o][e-i].remove=!0}var u=0;return D(function(e,t,n){n.remove&&u++}),u},ee=function(){for(var e=0;e<v.TILE_WIDTH;e++)for(var t=v.TILE_HEIGHT-1,n=v.TILE_HEIGHT-1;t>=0;t--,n--){for(;n>=0&&a[e][n].remove;)n--;if(t!=n){var o=n>=0?a[e][n].color:Y(v.COLOR_NUMBER),r=a[e][t];r.move(e,n,o),d.push(r)}}D(function(e,t,n){n.remove=!1})},te=function(){u.drawImage(l,0,0);var e=[block0,block1,block2,block3,block4];D(function(t,n,o){o.remove||u.drawImage(e[o.color],o.getX()*v.TILE_IMAGE_SIZE+v.BACK_IMAGE_LEFT_MARGIN,o.getY()*v.TILE_IMAGE_SIZE+v.BACK_IMAGE_LEFT_MARGIN,v.TILE_IMAGE_SIZE-2,v.TILE_IMAGE_SIZE-2)}),u.font="bold 80px sans-serif",u.fillStyle="rgba(255, 255, 255, "+p/v.MOVE_COUNT+")",u.fillText(w[y],300,300),u.fillStyle="white",i.isGameover()&&u.fillText("FINISH",350,350),u.fillStyle="rgba(220, 133, 30, 50)",u.font="bold 50px sans-serif",u.fillText(("0000000"+c).slice(-7),680,170);var t=Math.min(v.TIMER_IMAGE_NUMBER,Math.floor(G/(v.TIME_LIMIT/v.TIMER_IMAGE_NUMBER)));u.drawImage(f[t].get(0),615,327)};window.onload=P},{"./config":1,"./flag":2,"./mouse_utility":4,"./tile":5}],4:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(){o(this,e)}return r(e,[{key:"getXPosition",value:function(e){return isNaN(e.offsetX)?e.touches[0].clientX:e.offsetX}},{key:"getYPosition",value:function(e){return isNaN(e.offsetY)?e.touches[0].clientY:e.offsetY}}]),e}();n["default"]=i},{}],5:[function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(n,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),i=function(){function e(t,n,r){o(this,e),this.x=t,this.y=n,this.moveX=t,this.moveY=n,this.count=0,this.moveSpeed=r,this.moving=!1}return r(e,[{key:"getX",value:function(){return this.x+(this.moveX-this.x)*this.count/this.moveSpeed}},{key:"getY",value:function(){return this.y+(this.moveY-this.y)*this.count/this.moveSpeed}},{key:"move",value:function(e,t,n){this.moveX=e,this.moveY=t,this.color=n,this.count=this.moveSpeed,this.moving=!0}},{key:"update",value:function(){--this.count<=0&&(this.moving=!1)}}]),e}();n["default"]=i},{}]},{},[3]);